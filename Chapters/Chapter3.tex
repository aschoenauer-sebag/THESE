\lhead{Chapter 3 - \emph{High-content screening data as a resource}}

\chapter{High-content screening data as a resource}
\label{chap:reuse}
\section{Data re-use in Bioimage Informatics}
\paragraph*{}
\textit{Bioinformatics} solves biological questions using computer science methods: as put by Wikipedia, it "develops methods and software tools for understanding biological data". Hence it revolves around data.

Most of the time, biological data is produced by a laboratory or a consortium thereof in order to answer a specific question. As an example, the Mitocheck dataset~\cite{pmid20360735} was produced by the Mitocheck consortium to identify the human genes which are involved in cell division. 

However, there is never a single paradigm to look at a specific dataset. To go further, most datasets should be treated as a scientific resource to their parent laboratory and to the community, rather than a one-article commitment. Indeed, they can be re-used to either go further on the same question, either answer a different one. By \textbf{data re-use}, we target studies which will be based, mostly or as a starting point (e.g. getting a list of hit genes) on existing data. The re-use of biological data enables research to be sustainable by optimally exploiting existing experimental data. It also eases method comparisons by the existence of easy-to-access common datasets. Finally, as pointed out by~\cite{pmid24904347}, it is well in harmony with the current trend of general transparency in science. To continue with the Mitocheck example, two articles have been re-using it since the original paper ~\cite{pmid20360735} was published:~\cite{pmid25255318} searches for evidence of protein-protein interactions in siRNA experiment similarity, whereas~\cite{pmid24131777} dynamically models nuclear phenotypes.

\paragraph*{}
However big the advantages of data re-use, its requirements are not light. First of all, data and metadata should be of a minimal quality, for it to be understandable by other laboratories and re-analyzable. Laboratories should also share vocabularies, as well as formats, for data to be easily accessed and understood by all parties. Data re-use should be born in mind while acquiring it~\cite{pmid23047157}, since post-experimental data re-organization is harder and likely to never happen. Hence data re-use should never be a project afterthought. Finally, data should be persistent, which demands time, fundings, and incentive. Indeed, if web servers are used for data storage and access, their maintenance will need time and fundings. If individuals are contacted for information about data access, their responding will demand time and incentive~\cite{pmid18636105}.

\paragraph*{} The current state of data re-use in Bioinformatics depends much on the subfield, for maturity and culture reasons~\cite{pmid24904347}. Indeed, rather mature subfields have been sharing and re-using their experimental data for some time, whereas others only experiment isolated initiatives yet. If we consider the example of genomics,~\cite{pmid24109559} finds that this field sees quite a high level of third-party dataset re-use, since they expect 40 (resp. more than 150) PubMed papers re-using data by year 2 (resp. year 5) if 100 datasets were deposited at time 0\footnote{However, this meta-study suffers from some limitations, one of which is to not define data re-use.}. This is permitted by the existence of well-known servers where to deposit and search for functional genomics data, such as the Gene Expression Omnibus,  GEO\footnote{\href{http://www.ncbi.nlm.nih.gov/geo/}{http://www.ncbi.nlm.nih.gov/geo/}}. On the other hand, if we consider the example of Neuroscience,~\cite{pmid24904347} precisely suggests to learn from data sharing in genomics, and more specifically the Human Genome Project, in the context of the BRAIN Initiative. %QSAR models,~\cite{pmid24910716} proposes an approach for the digital organization and archiving of QSAR model information (although there are already two existing). 
%Does not define data reuse (does it mean they produced new results from published data, or that they compared their results/tried their methods on the existing datasets?). High level of third-party dataset reuse (if data deposited on GEO) : "for 100 datasets deposited in year 0, we estimate that 40 papers in PubMed reused a dataset by year 2, 100 by year 4, and more than 150 by year 5." (but data reuse is simply measured by presence of dataset number in text body).

\paragraph*{}
If we now consider this thesis subfield, namely \textit{Bioimage informatics}, initiatives remain isolated. A list of existing bench test datasets can be found in ~\cite{pmid18603566}, section 5.1, which are different of the existence of an ecosystem for data sharing. %Initiatives are quite numerous when it comes to medical images, e.g.~\cite{pmid24309199} for radiographical images, or [CITE] [CITE].
Most of the time, experiments are conducted in view of one or a few publications within the same team ; it is still rare that people re-mine third-party published data. This is probably not due to format issues. Indeed, there are open-source formats and plugins to convert from proprietary formats to open-source ones (eg OME-TIFF format\footnote{\href{http://www.openmicroscopy.org}{http://www.openmicroscopy.org}} or Bio-Formats\footnote{\href{http://www.loci.wisc.edu/ome/formats.html}{http://www.loci.wisc.edu/ome/formats.html}}, and translation plugins available for, e.g., ImageJ~\cite{imagej}). Concerns about patient consent and robust data anonymization are neither likely to be an issue as far as cell lines, tissues and small organisms are imaged, although it should be considered when sharing data about, e.g., primary tumors.

I see three main reasons for the little re-use which is currently experienced in Bioimage informatics. First of all, there is the need for shared controlled vocabularies, as also noted by~\cite{pmid18603566}. The network of excellence \textit{Systems microscopy} launched the initiative to build one\footnote{\href{http://www.ebi.ac.uk/ontology-lookup/browse.do?ontName=CMPO}{http://www.ebi.ac.uk/ontology-lookup/browse.do?ontName=CMPO}}, hence it will hopefully change in the future.

The second reason comes from practical considerations. There is a need for \textit{one} main famous physical server where Bioimage informatics data would be uploaded and further stored and accessed. Still, some datasets will not be downloadable (as an example, the Mitocheck dataset amounts to approximately 12 Tb). This prompts the need for further technical thinking (a common computing cloud?), which in its turn prompts the need for some dedicated collaborative funding. This is currently not easily done, as fundings are traditionally publication-based.% Nevertheless, more and more grant application calls insist that researchers commit to

But this will not be a problem, as long as people have a strong incentive to do it. And indeed the third most important reason is the lack of recognition from scientific publishers for papers which are doing re-mining only (as is apparently also the case in Neuroscience~\cite{pmid24904347}). If one sees little prospect of publishing in a good journal his/her data re-mining study, since it also demands finding, downloading and understanding somebody else's experiments, she/he will probably choose to produce new data.
%\begin{itemize}
%\item this is not 
%\item but more probably to the need for controlled vocabularies (\cite{pmid18603566} agrees, and an example of such an initiative: http://www.ebi.ac.uk/ontology-lookup/browse.do?ontName=CMPO in \textit{Systems Microscopy}, ie it's developing)
%\item the need also for a place where to put this data (exists various websites but none is really better recognized than the others. Also with what money for servers and maintenance?)
%\item AND most of all, to the lack of recognition from scientific publishers for papers which are doing data remining only.
%\end{itemize}  

\paragraph*{}Because we think that there is still unexploited information in the Mitocheck dataset, and more generally that data re-use should be encouraged in Bioimage Informatics, we chose to apply MotIW to this data. This led to the discovery of genes which are likely to be involved in cell motility, as well as an ontology of cell trajectories (section~\ref{sec:mitocheck}). Furthermore, combining tracking with nuclear phenotypic classification enables to detect genes which have an impact on cell cycle length, as described in section~\ref{sec:cellcycle}. Finally, in the context of drug development, the comparison between Mitocheck phenotypic profiles and those following drug exposure enables to identify a few possible drug target pathways for each investigated substance, as is exposed in section~\ref{target_inference}.

\section{MotIW's direct application to the Mitocheck dataset}
\label{sec:mitocheck}
 Analysis of the screening data through our workflow enables the labelling of a list of genes as likely to be involved in cell motility (section~\ref{sec:hitlist}). Furthermore, it reveals the existence of a cell trajectory ontology in the dataset. Without any prior assumption on cell motion, we are able to identify eight types of cell trajectories (section~\ref{sec:ontology}).

Furthermore, studying how cell tracks distribute in the different motility patterns according to whether they are exposed agrees with the following paradigm: rather than creating new
motility behaviours, chemical exposure perturbs how cells distribute in the different possibilities, which also exist in the basal state.
\subsection{Hit list}
\label{sec:hitlist}
After evaluating MotIW on simulated data, we then apply it to the whole genome-wide screen Mitocheck~\cite{pmid20360735}. In the context of the Mitocheck dataset, the identification of an experiment in which cell motility is significantly different from negative controls leads to the identification of siRNAs which significantly and reproducibly alter cell motility. A gene was selected as possibly involved in motility mechanisms if it was targeted by at least one hit siRNA. Indeed, it is well known that strictly less than 100\% siRNAs which are targeted at a particular gene will effectively down-regulate it. The reasons which could explain this are still not completely understood. Therefore, requiring that more than one siRNA related to a given gene are selected for the gene to be selected would have led to too many false negatives.% Indeed, Mitocheck siRNAs supplier guaranteed that one out of 2 would actually work.

The application of MotIW to the Mitocheck dataset enabled the identification of the experiments which significantly deviate from controls ($5\%$; $7,153$ out of $144,909$). It amounts to $1,180$ genes (out of $17,816$), which are available as a supplementary to this thesis (see Supp. table 1).%http://cbio.ensmp.fr/~aschoenauer/qvalues_motility_Mitocheck.csv

\paragraph{Intersection with other published motility gene lists}
Some of these genes are well known to be involved in cellular motility, such as RhoA (Ras homolog family, member A) or CDK5 (cyclin-dependent kinase 5). However, the list is not overall significantly enriched in genes which are linked to cell motility according to the Gene Ontology database. This is also the case for all recent screens, regardless of their throughput.~\cite{pmid19160483} describes a study of 1,081 genes regarding cell motility in human breast cells (MCF-10A cell line). Using wound healing, they identify 66 high confidence genes of which only 24 were previously associated with cell motility. Similarly,~\cite{pmid21423205} is focused on the involvement of kinases (779 genes) in cell motility of human lung cancer cells (A549 cell line). Using single cell tracking, they identify 70 hit genes, of which only 13 were previously linked to cell motility. Finally,~\cite{pmid25774502} study 1,429 genes using phago-kinetic tracks in human lung cancer cells (H1299 cell line), finding 136 hits. Thanks to a personal communication of the authors, we could access their hit list and see that only 13 of their hit genes are functionally linked to cell motility (Gene Ontology biological process GO:0048870). 

Hence it seems that medium- to HT approaches to cell motility study tend to complement the older ones, rather than abide by them. In fact, this seems to be a more general trend of genetic screen hit lists. For example, Mitocheck mitotic hit list contains more than 50\% genes which were not functionally linked to cell division before~\cite{pmid20360735};~\cite{pmid15547975}'s cytokinesis-linked gene list contains only 20\% genes which were previously known to be involved in this cellular process. Modern systematic and automatic approaches to gene functional inference are indeed likely to detect genes whose involvement in the cellular process at hand was too subtle to be detected by lower-throughput and more ancient methods.

A question which arises next is to know the extent of the intersection between gene lists from published medium- to high-throughput studies about cell motility. They are detailed in table~\ref{details_biblio}.

\begin{table}[!ht]
\centering
\caption{Existing medium- to high-throughput studies of cell motility}
\label{details_biblio}
\begin{tabular}{|l|l|l|l|l|}
\hline
Study & Assay & Cell line & Gene list & Hit gene list \\
\hline
\cite{pmid19160483} & Wound healing & MCF-10A & 1,081 & 66\\%Simpson
\cite{pmid21423205} & Single cell tracking & A549 & 779 & 70\\%Lara
\cite{pmid23593504} & Matrigel invasion chambers & U87 & 1,954 & 25\\%Yang
\cite{pmid23751374} & Cell area growth & HeLa & 710 & 81\\%Zhang
Us & Single cell tracking & HeLa & 17,816 & 1,180\\%Us
\cite{pmid25774502} & Phago-kinetic tracks & H1299 & 1,429 & 136\\%Water
\hline
\end{tabular}
\end{table}
\begin{table}[!ht]
\centering
\caption{Hit list intersections}
\label{intersection}
\begin{tabular}{|l|l|l|l|l|l|l|}
\hline
& Simpson & Lara & Yang & Zhang & Us & van Roosmalen \\
\hline
\cite{pmid19160483}&  66& 4 &0&19&10&4\\%Simpson

\cite{pmid21423205} &4&70 &0&4&4&2 \\%Lara

\cite{pmid23593504} &0&0 &25&0&4&0\\%Yang

\cite{pmid23751374} & 19 &4&0&81&13&5\\%Zhang
Us & 10 & 4 & 4 & 13 &1,180&6 \\%Us
\cite{pmid25774502} & 4 & 2 & 0 & 5 & 6 & 136\\%van Roosmalen
\hline
\end{tabular}

\end{table}
%HC Simpson: 10 not in Mitocheck study, 10 in common out of 66. Both HC and MC: 19 not in Mitocheck study, 16 in common (out of 142). Have 19 MAR genes among the HC.
%We have 130 genes from Simpson study (138 siRNAs) of which 34 MAR genes (314 MAR genes). Hence that's approximately the same "concentration" of MAR genes although not designed for this (26\% for us, 29\% for them).
%
%Lara: 70 hit genes of which 13 not in Mitocheck. 4 genes in common with us, also 4 genes in common with Simpson HC. No MAR genes.

Following the information which is presented in table~\ref{intersection}, there is little intersection between the hit genes which were obtained by the existing medium- to high-throughput studies of cell motility. This can be explained by the fact that all studies use distinct assays and/or cell lines. On top of the experimental differences which could partly explain such little overlap, one could think about the following biological explanations. First of all, it is likely that (at least partly) different cellular processes are at play in collective and single cell migration. Second, it could be the case that each cellular model (such as normal breast epithelial cells, lung cancer epithelial cells, cervix cancer epithelial cells) is depending on specific and partly distinct machineries for cell motility. All these reasons would explain that all studies find such "stars" of cell motility as RhoA, but have little intersection otherwise. As for hit list enrichment in previously known genes, little overlap is generally observed between medium- to HT screen outputs~\cite{pmid20360735}.

\paragraph{Detailed functional analysis [TODO]}
\textcolor{blue}{Wait for Piel's lists and then at least do two paragraphs here to discuss the results using Gene Ontology and his lists with this kind of statement}:  As an exemple, cells are observed to be motile when they divide as they detach from the plate surface, but it has nothing to do with directed motion. Hence it is normal that we find more than just cell migration. Think about~\cite{pmid18213366} "these data indicate that changes in cell migratory behavior caused by the different can-
didate migration genes are largely dominated by changes in cell matrix adhesion dynamics."

ZRANB1: found to produce stress fibers in \cite{pmid21834987} and inhibit wound closure in PC3 cells. If I look at intersections with other screens, I can also cite them as saying their genes were not found by Collins et al 2006.

\subsection{Cell trajectory ontology}
\label{sec:ontology}
A question which is related to motility gene discovery is to know whether there exists an ontology of cell trajectories. The approach to answer it would be to apply unsupervised clustering methods on the whole trajectory dataset and try to identify a number of motility patterns for which the clustering is of good quality. This is measured by cluster quality indices, which depend on the clustering method (see e.g.~\cite[Chapter~8]{Tan:2005:IDM:1095618}, or~\cite{Halkidi}). As an example, two common indices to evaluate the output of k-means are the intra-cluster cohesion $C(K)$ and the silhouette score $S(K)$. They both compare intra-cluster distances to inter-cluster distances, if $N$ is the number of data points centered in $c_{data}$:

\[
C(K) = \sum_{\substack{k}} \sum_{\substack{x \in c_k}} \dfrac{d(x, c_k)^2}{d(x, c_{data})^2}\]

\[
S(K) = \dfrac{1}{N} \sum_{\substack{x}} \dfrac{b_x-a_x}{\max (a_x, b_x)}\]
where \[ a_x = mean \{d(x,y) | y \in c_{k_x} \},\ \ b_x = \min_{\substack{k\neq k_x}} mean \{d(x,y) | y \in c_k \}
\]

A slope change in $C(k)$ and a maximum in $S(k)$ are expected at the appropriate number of clusters, if it exists. Other interesting measures of clustering quality encompasses for example the Bayesian Information Criterion or clustering stability~\cite{pmid11928511}.

This approach did not prove to be successful when applied to pooled trajectories from all experiments, for a wide range of clustering techniques (k-means, Gaussian mixtures models, spectral clustering, fuzzy c-means, kernel k-means with a radial basis function - data not shown). Concretely, no combination of clustering algorithm and cluster number could be found, whose quality was clearly over the quality obtained by the same clustering algorithm and other cluster numbers. It seemed as if no structure could be found in the data.

Nevertheless, the clustering approach succeeded when only trajectories from the \textbf{detected} experiments were pooled together. Indeed, this small subset contains only experiments which have been selected for being significantly different of controls in terms of single cell motility: it is enriched in rare trajectories. Our interpretation for this result is the following. Let us assume that we have a number of $k$ clusters in the whole trajectory dataset. Due to biological variability, each trajectory is at a certain random distance (in the feature space) to its latent trajectory cluster center. Given the dataset size (approximately 50 million trajectories), this produces a continuous dataset in the feature space, preventing the identification of any cluster. Furthermore, the different clusters are unbalanced. It is therefore not sufficient to uniformly subsample the whole dataset to detect the clustering structure (data not shown). Applying MotIW to find experiments which are enriched in rarer trajectories functioned as performing a stratified subsampling with respect to the underlying cluster structure of the dataset. It made it possible to identify the latter.

 After retaining the first seven principal components (explaining $95\%$ of the variance), k-means was applied to the resulting dataset of approximately 1.1 million trajectories. Fig.~\ref{clusterscore} shows the evolution of intra-cluster cohesion and silhouette score with respect to the number of clusters. It points to $k=8$ as being both the best and a good quality clustering on this dataset. Indeed, a break and a maximum are respectively expected in the cluster cohesion and the silhouette score curves at the correct cluster number, if it exists. It is compared to the evolution of those indices, if k-means is applied to a uniformly random dataset and a normal dataset (in $\mathbf{R}^8$). 

\begin{figure*}[!ht]
\centerline{\includegraphics[scale=0.3]{figures/Walter_295_fig_6.png}}
\caption{Evaluation of k-means clustering quality as a function of the number of clusters (average and standard deviation on 10 algorithm initializations). The same protocol was applied to a subset of the Mitocheck dataset, and two samples of the same dimensions, respectively drawn from the Uniform and the Normal distributions. }
\label{clusterscore}
\end{figure*}

A first insight on cell motility from this clustering is presented figure~\ref{distribution}. It presents the distribution of trajectory distributions in the eight identified clusters. One can observe that there are no cluster which is specific either to controls, either to hit experiments. This answers the question to know whether gene silencing creates new motility behaviours, or rather modify the probabilities that a cell belongs to a certain trajectory cluster. This figure shows that it is the latter which happens: siRNA exposure modifies how likely it is that a cell will belong to a certain cluster, but does not create new behaviours. This could be explained by the fact that a certain number of motility behaviours are possible for the cell to adopt at any time. Which one it chooses is function of its cellular and molecular state, as well as the stochasticity of gene expression. Hence some behaviours will be rarer in control videos, but exist nevertheless, which will become more frequent under a modification of the cell molecular state due to siRNA exposure.

\begin{figure*}[!ht]
\centering
\includegraphics[scale=0.25]{figures/traj_distribution_clusters_EXP_CTRL.png}
\caption{Comparison of cluster distributions between controls (Ctrl) and experiments (Exp) for the eight trajectory clusters which were identified in the Mitocheck dataset. The clusters are in the same order as in figure ~\ref{heatmap}.}
\label{distribution}
\end{figure*}
 
The cluster characteristics are detailed fig.~\ref{heatmap}. Each column in the heatmap corresponds to one cell trajectory, for which the rows show the standard scores of a subset of features. 

A result about single cell motility patterns is obtained from experiments which were selected on the basis of their trajectory feature distributions. This shows that meaningful single cell information can be retrieved by our statistical procedure, which works at the experiment level.

In the second place, it shows that there is more than speed for differentiating trajectory types. For example, clusters 2 and 3 present very similar MSDs and \textit{Effective space length}. However, trajectory curvatures are different: the features \textit{Mean curvature} and \textit{Straigthness index} are quite distinct between the two clusters. This can be observed in the Supplementary movie, where cells whose trajectory belongs to cluster 2 (green) are much straighter than those belonging to cluster 3 (red). In this video, cells whose trajectory passed the trajectory quality control have a dot, whose colour corresponds to its cluster as indicated in fig.~\ref{heatmap}.

\begin{figure*}[t!]
\centerline{\includegraphics[scale=0.3]{figures/Walter_295_fig_7.png}}
\caption{Characterization of our ontology of trajectories. Each column is a single cell trajectory ; trajectories are grouped by cluster label. 1,000 trajectories were randomly selected per trajectory cluster.}
\label{heatmap}
\end{figure*}
\subsection{Discussion [TODO eventually]}
discussion\clearpage
\section{Cell cycle length study}
\label{sec:cellcycle}
The combination of the Mitocheck dataset and of our methodological workflow is also very well suited to study cell cycle genes. Indeed, one only needs to combine tracking and nucleus classification to recover a set of complete trajectories in each experiment, that is, trajectories which start with a mitosis and end with a mitosis. Using the methodological procedure described in~\ref{sec:stats}, it is then possible to detect the experiments in which cell cycle length distribution is significantly different than that in control experiments, resulting in a list of genes.
\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.6]{figures/cell_cycle_examples.png}}
\caption{Examples of object divisions from the Mitocheck dataset}
\label{cellcycle2}
\end{figure*}
\subsection{Complete cell cycle detection}
%\paragraph{Complete trajectory identification}
The first step to study cell cycle length distribution according to siRNA exposure is to filter out complete trajectories from the others. By complete, we mean trajectory which start with a mitosis rather than the end of a \textit{merge} event, an apparition, the split of an apoptotic debris or the beginning of the film, and which end with a mitosis rather than a \textit{merge}, a disappearance or the end of the film. The distinctions are easily made by a human eye, as can be seen on figure~\ref{cellcycle2}. To automatize this filtering, one can rely on the nucleus classification as described in section~\ref{Mito_classif} and~\cite{pmid20360735}: prior to a mitosis, the nucleus will likely be observed in $M_{-1}=\{$\textit{prometaphase}, \textit{metaphase}, \textit{metaphase alignement problem}$\}$. Similarly, following a mitosis, the nucleus will likely be observed in $M_{+1}=\{$\textit{anaphase}$\}$. 

However, given that the classifier is not 100\% correct, it is not fully certain. Furthermore, there could be cases of accelerated mitoses, in which it would not be possible to observe both the mother cell in $M_{-1}$ and the daughter cell in $M_{+1}$. Hence we developped a scoring approach with respect to each track of interest $\tau$ going from $T_0$ to $T_f$, as detailed in figure~\ref{cellcycle1}:
 \[score_{1, \tau} = \mathbf{1} (Mother_\tau \in M_{-1}) + \mathbf{1} (\tau_{T_0} \in M_{+1}) \]
 \[score_{2, \tau} = \mathbf{1} (\tau_{T_f} \in M_{-1}) + \sum_{\substack{\tau 's~ children}}\mathbf{1} (c \in M_{+1}) \]
 
Briefly, the scores compute the number of \textit{right} classifications in the starting and ending splits. To evaluate where to threshold those scores in order to filter out the unwanted tracks, 20 movies were randomly sampled from the Mitocheck dataset, all splits scored and all 2,100 tracks manually divided into complete and other trajectories. Selecting tracks longer than 1 frame with $score_1\geq 1$ and $score_2\geq 1$ enables to select more than 87\% complete trajectories.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.3]{figures/cell_cycle_study.png}}
\caption{Approach to cell cycle study}
\label{cellcycle1}
\end{figure*}

\subsection{Cell cycle length hit list}
The principle of MotIW's statistical procedure~(see~\ref{sec:stats} and~\cite{motiw}) was then applied to the distributions of complete trajectory length: 2 sample Kolmogorov-Smirnov tests were realized between cell cycle length distributions of each experiment and the controls of the same batch. It was compared to the empirical null distribution in a second time. The latter is the distribution of 2 sample Kolmogorov-Smirnov tests comparing controls to controls. Finally, the empirical p-values which were obtained were adjusted for multiple testing, following the Benjamini-Hochberg procedure~\cite{Benjamini1}.

Setting a threshold of $0.05$ enabled the identification of 66 genes whose cell cycle length distribution differs from that of controls from the same batch. The list is fully provided in appendix, see section~\ref{cellcyclelist}. Interestingly, the down-regulation of only three genes produces a \textit{longer} cell cycle length: APOA1, RPS20, SFMBT2 (coding respectively for the apolipoprotein A1, ribosomal protein S20 and Scm-like with four mbt domains 2). SFMBT2 silencing has already been found to decrease cell growth in human prostate cancer cells~\cite{pmid23385818}. 

Gene Ontology analysis reveals that there are three annotation clusters which are highly enriched in this list. The first one is related to protein kinase activity. It contains such genes as BMPR-IB which encodes the bone morphogenetic protein receptor, type IB, and whose reduced expression is correlated to poor prognosis in breast cancer~\cite{pmid19451094}, and tumor grade in prostate cancer~\cite{pmid10850425}. The second cluster is related to nucleotide binding. It contains genes such as the integrin-linked kinase whose silencing has interestingly been found to slow cell cycle in human gastric carcinoma cells~\cite{pmid23748822}, whereas we have found its silencing to speed cell cycle in HeLa cells. Finally, the third cluster contains genes which encode proteins which are intrinsic to plasma membrane, such as the melatonin receptor 1A whose absence has been found to be correlated with bad prognosis in triple-negative breast cancer~\cite{pmid23250547}.  

\subsection{Discussion}
Our approach for studying cell cycle length enabled us to obtain a list of 66 genes which may be involved in cell cycle regulation. Gene Ontology analysis revealed that a certain number of these genes has already been found to be linked to cell cycle duration regulation. This list contains 3 genes whose silencing lengthens cell cycle, and 63 whose silencing shortens it. It is possible that this more broadly reflects that there are more proteins which play a role of checkpoints rather than cell cycle enhancers, hence the fact that gene silencing experiments produce more experiments where cell proliferation is increased than decreased. This is supported as well by other studies such as~\cite{pmid16564017}, which found 87 (resp. 15) genes whose silencing significantly increases (resp. decreases) the mitotic index of HT29 cells.

\paragraph{Method bias}
Our method was applied to the whole Mitocheck dataset, enabling the obtention of complete trajectory length distributions for all experiments. Experiments with less than 10 complete trajectories were not considered for further analysis. This explains why decreased proliferation genes as provided by~\cite{pmid20360735} could not be found: the proliferation is so low that no mitosis is observed, hence no complete trajectories can be found. Trying to diminish this bias in experiment selection, we also included trajectories which finish with the end of the experiment rather than a mitosis (hereafter called \textit{incomplete} trajectories). 

However, this approach was not successful. For some siRNAs, it seems that incomplete trajectory length distribution indeed has the same shift as that of \textit{complete} ones (see the example of arylsulfatase F gene, ARSF, on fig.~\ref{ARSF}). However, for most of the siRNAs, incomplete trajectory length distributions seem to be more dependent on the batch than on the chemical exposure. Two examples are shown fig.~\ref{CAC} which concern the genes CACNA1D and DIMT1 (respectively coding for the calcium channel, voltage-dependent, L Type, Alpha 1D subunit and DIM1 dimethyladenosine transferase 1 homolog). The outcome of the statistical analysis consistently proved too noisy to enable the detection of any hit siRNA for incomplete trajectory length (up to the following threshold for adjusted p-values: $0.1$).

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.3]{figures/ARSF_length_distribution_cens.png}}
\caption{Histograms showing cell cycle length for complete (top) and incomplete (bottom) trajectories, for two experiments of the Mitocheck dataset concerning ARSF which were detected as significantly different from controls for cell cycle length.}
\label{ARSF}
\end{figure*}
\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.3]{figures/CACNA1D_length_distribution_cens.png}
\includegraphics[scale=0.3]{figures/DIMT1_length_distribution_cens.png}
}
\caption{Histograms showing cell cycle length for complete (top) and incomplete (bottom) trajectories, for two experiments of the Mitocheck dataset concerning CACNA1D (left) and DIMT1 (right), which were detected as significantly different from controls for cell cycle length.}
\label{CAC}
\end{figure*}

\paragraph{Perspective: cell cycle phase detection}
The cell cycle can furthermore be split in four sequential phases: $G_1$, $S$, $G_2$, and $M$. $S$ is the DNA replication phase and $M$ stands for mitosis. To distinguish $S$ from $G_1$ and $G_2$, PCNA (proliferating cell nuclear antigen) is usually used. It forms sparkling nuclear dots during DNA replication, as it is recruited to replication foci~\cite{pmid10769021}.

However, the only marker available in the Mitocheck dataset is the core histone 2B (H2B). The question is then to know whether it is possible to use this marker for $S$ detection.~\cite{pmid16765323}, using cell size and H2B-GFP fluorescence, managed to FACS-purify RKO cells in $G_1$, $S$ and $G_2$. Furthermore,~\cite{pmid17401369} uses a "cell cycle heuristic" to separate between the different phases of the cell cycle using DNA size and intensity as provided by Hoechst 33342 as a DNA marker (Supplementary figure 3,b-c). They use it to infer links between small molecule exposure and cell cycle modification; however they do not prove the accuracy of their heuristic.

This led us to the hypothesis that it might be possible to use the information contained in the H2B-GFP fluorescence signal for \textit{in silico} sorting of HeLa cells. However, nuclear size and intensity as provided by H2B-GFP do not seem to make $S$ identification possible. Indeed, as shown on fig.~\ref{intensity_roisize}, they grow linearly during cell cycle without showing any clear slope break. This is confirmed on fig.~\ref{intensity_roisize2}. This latter plot has the same configuration as that of Supp. fig. 3 from~\cite{pmid17401369}. However, although this study uses a heuristic model that defines a clear separation between nuclei in different cell cycle phases, we do not find it in our data. This might be due to slight differences between the information from DNA intercalating agent fluorescence, such as Hoechst 33342, and the information from histone 2B fluorescence. Nevertheless, nuclear intensity and size are clearly linked to cell cycle phases.

Hence to answer this question, we had the idea to use a published dataset of HeLa cells which were stained for both H2B and PCNA~\cite{cellcognition}. Cell cycle phase annotations of this dataset are available on the Cell Cognition website\footnote{\href{http://www.cellcognition.org/downloads/data}{http://www.cellcognition.org/downloads/data}}. This training set was created using the information on the PCNA channel. It makes it possible to test the following hypothesis: can a classifier be trained, which uses H2B information for cell cycle phase identification? Preliminary work shows that all tested methods have an accuracy below 70\% (random forest, gradient boosting, support vector machine, logistic regression). However, using both this information and cell tracking, one can hope that the use of Markov chains for correcting classification errors could lead to good results.
\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.6]{figures/roisize-LT0013_01--00315.png}
}
\caption{Example of the time evolutions of nuclear size ("roisize", top left and bottom) and nuclear intensity ("total intensity", top right) for all complete trajectories of a control experiment from the Mitocheck dataset. As discussed in the text, no clear slope break is seen for most trajectories for any of the two indicators, hence preventing the delimitation of cell cycle phases using only this information.}
\label{intensity_roisize}
\end{figure*}
\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.3]{figures/fig_intensity_DNAsize_cyclephases2.png}
}
\caption{DNA intensity and size as provided by H2B-GFP information is not sufficient to differenciate between the different cell cycle phases. Data and labelling come from the PCNA dataset.}
\label{intensity_roisize2}
\end{figure*}
\clearpage
\section{Functional inference by in silico comparison of small-molecule and siRNA screens}
\label{target_inference}
Finally, on top of enabling the discovery of cell cycle and motility genes, and identifying an ontology of cell trajectories, the Mitocheck dataset can be re-used for drug target inference\footnote{Manuscript in preparation}.

Indeed, genome screens contain very rich information about how gene selective knockdown perturbs normal cell processes such as cell division, cytoplasmic morphology or motility. If cells are screened against drugs or putative drugs in the same experimental context (e.g. the same seeding density, the same markers, the same cell line), the comparison between drug exposure profile and genetic profiles can point at the biological processes which the drug targets~\cite{pmid16901791}. The comparison between gene knockdown and drug phenotypic profiles is therefore more and more considered as an efficient tool for drug discovery~\cite{pmid19568283}. In principle, it should allow for the systematic and direct identification of drug target, as opposed to targeted bioassays which demand specific prior knowledge or an extreme amount of time and means.

This view has been applied under different forms in the recent years, either in the comparison of yeast deletion mutants to drug exposed yeast~\cite{pmid20418956}, or the comparison of parallel RNAi and small molecule screens in \textit{Drosophila}~\cite{pmid16901791} or HeLa cells~\cite{pmid18066055}.

However, when applied, it rapidly appears that these comparisons cannot directly point at \textit{the} drug target or mode-of-action. This is mainly due to two biological rather than technical reasons. On the one hand, drug action can often not be summarized by a unique "entry point" into an organism's cellular processes~\cite{pmid26272035}. On the other hand, two drugs which are targeted at different molecules albeit occuring in the same pathway will very probably produce the same phenotypic profiles. Inferred targets remain to be confirmed and/or refined~\cite{pmid23508189}.

A difficulty of another order for performing such inference is the complexity of HCS data and therefore the difficulty of exploiting it. For the same reason as the preference for univariate measures of cell motility, targeted bioassays can be preferred because they are easier to understand and exploit. Multivariate analysis methods for HCS profile comparison are however more and more developed~\cite{pmid17401369},~\cite{pmid18066055}. Nevertheless, drug target inference from HCS \textbf{time-lapse} data has to our knowledge never been done.

This section therefore presents different methods for drug target inference by phenotypic profile comparison between siRNA and drug screen experiments in HeLa-H2B cells. After introducing the dataset and the image analysis methods which were used (section~\ref{sec:math_methods_ds}), six distances between phenotypic profiles are introduced and compared (section~\ref{sec:distances}) before being applied to drug similarity evaluation and target inference in section~\ref{sec:applications}.

\subsection{Materials and methods}
\label{sec:math_methods_ds}
\subsubsection{Experimental work}
This data set was not produced in the context of this PhD. Rather, the experiments were conducted at the EMBL (Heidelberg, Germany) by **. For the sake of completeness, here is briefly how it was produced. [MISSING] see table~\ref{drug_dose}


\begin{table}[!ht]
\centering
\caption{Selected drugs and dose ranges. All drugs were tested for 11 doses.}
\label{drug_dose}
\begin{tabular}{|l|l|l|}
\hline
Drug& Dose 0 ($\mu$M) & Dose 10 ($\mu$M)\\
\hline
Acyclovir  & 0.036 & 36.768\\
(-)-Adenosine 3  & 0.025 & 25.152\\
Aminopurine, 6-benzyl  & 0.036 & 36.76\\
Anisomycin  & 0.03 & 31.209\\
Azacytidine-5  & 0.033 & 33.907\\
Camptothecine(S,+)  & 0.023 & 23.77\\
Daunorubicinhydrochloride  & 0.014 & 14.682\\
Dexamethasoneacetate  & 0.019 & 19.057\\
Doxorubicinhydrochloride  & 0.014 & 14.277\\
Epiandrosterone  & 0.028 & 28.509\\
Etoposide  & 0.014 & 14.068\\
Hesperidin  & 0.013 & 13.562\\
Idoxuridine  & 0.023 & 23.384\\
JNJ7706621  & 0.008 & 8.28\\
MLN8054  & 0.008 & 8.28\\
Methotrexate  & 0.018 & 18.221\\
Nocodazole  & 0.027 & 27.48\\
Paclitaxel  & 0.009 & 9.697\\
R763  & 0.008 & 8.28\\
Ribavirin  & 0.033 & 33.907\\
Sulfaguanidine  & 0.038 & 38.647\\
Sulfathiazole  & 0.032 & 32.43\\
Thalidomide  & 0.031 & 32.065\\
VX680  & 0.008 & 8.28\\
Zidovudine, AZT  & 0.03 & 30.984\\
\hline
\end{tabular}
\end{table}

\subsubsection{Object segmentation}
\label{sec:ds_seg}
Since we are interested in nuclear morphologies in this context, the original segmentation of the Mitocheck project was used, as previously described~\cite{Walter2010}.

\subsubsection{Object classification and phenotypic scores}
\label{sec:ps}
The use of the original segmentation from the Mitocheck project made it possible to re-use its training set, albeit strengthened for classes which were previously slightly under-represented. This can be seen on fig.~\ref{ds_classifier} in comparison with figure 3 from~\cite{Walter2010}. A visual inspection of the dataset enabled us to verify that the drug screen experiments do not contain any nuclear morphological phenotype which were not observed in the Mitocheck experiments. This would have made it necessary to include nuclei from drug screen experiments into our training set.

Cell Cognition~\cite{cellcognition} was used for learning an RBF (Radial Base Function) kernel SVM classifier, whose precision and recall are also indicated on fig.~\ref{ds_classifier}. Its parameters were optimised by grid-search ($\gamma=2^{-7}$, $C=8$).

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.6]{figures/ds_classifier.png}}
\caption{Precision and recall per class as provided by Cell Cognition. Compared with the original classifier as published in~\cite{Walter2010}, classes \textit{ADCCM} (Asymmetric Distribution of Condensed Chromosome Masses) and \textit{Out of focus} were added. More nuclei were furthermore included for training in most classes. \textit{Shape1} (resp. \textit{Shape3}, \textit{MetaphaseAlignement}) corresponds to binucleated (resp. polylobed, metaphase alignement problem) nuclei.}
\label{ds_classifier}
\end{figure*}

This provides a representation of each video as a set of time-series, which are the evolution of the percentage of nuclei in each phenotypic class over time. To evaluate how an experiment $i$ diverges from  control experiments from the same batch $C_i$ for its temporal evolution of class $k$, we used phenotypic scores as previously described~\cite{Walter2010}. Briefly, temporal evolutions of the percentages of nuclei in class $k$ for experiment $i$, $(\%_{k,i,t})_t$ and its controls $(\%_{k,C_i,t})_t$ are regularized using a locally weighted scatterplot smoothing as implemented in the Python package statsmodels. The fraction of data points which is used for smoothing was manually chosen to be $f=50\%$. The maximum deviation between the two regularized time series is then computed, where $ps$ stands for "phenotypic score":
\[
ps_{k,i} = \max_{0\ldots T} (\%^{reg}_{k,i,t} - \%^{reg}_{k,C_i,t})
\]

\subsubsection{Quality control}
One plate had to be eliminated due to an issue during image acquisition. An abrupt increase in fluorescence intensity around the 80\up{th} frame of all experiments from this plate causes a sudden increase in the number of detected object which prevent any time-consistent analysis.

For the other experiments, a threshold of $c$ cells at the beginning of the movie, and maximum $p$\% out-of-focus objects were used to remove unexploitable movies. $c=50$ and $p=40$ were selected. Out-of-focus objects and cells that were neither artefacts nor out-of-focus objects were identified following segmentation, feature extraction and classification as described supra.

Out of $1,232$ experiments on four plates, $904$ experiments from three plates passed the quality control, among which $98$ control experiments.

\subsubsection{Selection of Mitocheck experiments for target inference}
\label{sec:selection_mitocheck}
The Mitocheck project led to the identification of 1,249 mitotic hits in the primary screen. 1,042 were identified by manual thresholds on phenotypic scores from the following phenotypic classes: \textit{Prometaphase},\textit{Metaphase Alignement Problem}, \textit{Binucleated}, \textit{Polylobed}, \textit{Grape}. 207 genes were further identified by manual annotations. 1,128 of these genes were screened again in a validation screen.

Lists of hit genes according to the following measures were also published:
\begin{itemize}
\item phenotypic score of \textit{Large} nuclei,
\item cell death, as measured by phenotypic score of \textit{Apoptosis} nuclei,
\item nuclear dynamic changes, as measured by the sum of phenotypic scores for \textit{Hole}, \textit{Folded} and \textit{Small irregular},
\item and cell proliferation.
\end{itemize}

Finally, a list of hit experiments for \textit{Elongated} nuclei was computed, which can be found as a supplementary to this thesis (see Supp. table 2).

Given the evolution of the reference sequence of the genome, not all those genes were in fact targeted in the Mitocheck experiments. An updated mapping of the siRNAs which were used in the primary and validation Mitocheck screens to the present reference sequence of the genome was graciously provided by Jean-Karim Hériché (EMBL, Heidelberg, Germany). Once this and the quality control are taken into account, the final list of hits in at least one of the listed categories amounts to 2,614 genes (cf fig.~\ref{hit_mito}), which are covered by 4,847 siRNAs.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.4]{figures/gene_hit_mitocheck.png}
}
\caption{Number of hit genes per category. As hit detection is univariate, a gene can be in more than one category.}
\label{hit_mito}
\end{figure*}

Given the variations in siRNA coverage between genes which were, for example, included or not in the validation screen, each gene was chosen to be represented by the siRNA which showed the maximum effect. This was measured by the median of the phenotypic scores for \textit{Interphase} nuclei of this siRNA experiments.
%{ 'increased proliferation': 94, 'Cell Death': 746, 'Dynamic changes': 716, 'Large': 305, 'Elongated': 127, })

%publi mitotic: 'Grape': 91,'Binuclear': 402, 'Polylobed': 344, 'Mitotic delay/arrest': 345

\subsubsection{Detection of drug screen hit experiments}
\label{sec:selection_ds}
Phenotypic scores of the drug screen experiments were computed as described supra. Experiments whose \textit{Interphase} phenotypic score was lower than $Q_1^{ctrl} - 1.5\times IQR^{ctrl}$ were selected as hit experiments, where $Q_1^{ctrl}$ and $IQR^{ctrl}$ are respectively the first quartile and the inter-quartile range of control \textit{Interphase} scores. This is a robust one-sided way to select outliers, as the distribution of control \textit{Interphase} scores cannot be assumed to be Gaussian. 

It corresponds to the $197$ experiments which are under the bottom whisker on the \textit{Interphase} subplot of fig.~\ref{hit_ds}. Supplementary plots represent the distribution of phenotypic scores as a function of dose and drug, see "Phenotypic score plots\_type1" in "Supplementaries" folder.

Hit conditions are conditions for which stricly more than 50\% of their replicates are hit experiments.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.35]{figures/phenotypic_scores2.png}
}
\caption{Distributions of phenotypic scores from the drug screen experiments. Each boxplot corresponds to the distribution of control phenotypic scores, whereas each red dot is an experiment in which cells were exposed to a drug.}
\label{hit_ds}
\end{figure*}

\subsubsection{Other analyses}
\paragraph{Proliferation hit detection}
Proliferation hit detection was realized similarly to hit experiment detection: experiments whose proliferation rate was higher than $Q_3^{ctrl} + 1.5\times IQR^{ctrl}$ or lower than $Q_1^{ctrl} - 1.5\times IQR^{ctrl}$ were considered proliferation hit experiments. Proliferation hit conditions were conditions for which stricly more than 50\% of their replicates are proliferation hit experiments. Interestingly, only one condition (Azacytidin, dose 7) was a proliferation hit without being a hit.
\paragraph{Hierarchical clustering}
Condition hierarchical clustering was performed using the median of condition replicates. The Python package fastcluster~\cite{fastcluster} was used to this end. In each case, the clustering method which visually produced the best result was used, from Ward, centroid and single methods.
\paragraph{Data visualization}
A Web-based user interface was designed and implemented for result visualization and result sharing among collaborators. It is described more in details infra, see section~\ref{interface}.

\subsection{Phenotypic profile distances}
\label{sec:distances}
Screening experiments provide us with temporal sequences of information. They can be seen as sequences of intensity two-dimensional distributions~\cite{pmid22743764}, sequences of object feature distributions or sequences of phenotypic class distributions. In our case, we chose to summarize each experiment by a set of temporal evolutions of phenotypic classes, that is, we chose to represent our experiments by their phenotypic profile. The question remains to know how to compute divergences between these representations of the information.

%\subsubsection{Investigated distances}
We decided to test the following distances on the question to know whether we can apply phenotypic profiling for drug target inference from parallel drug and siRNA screens:
\begin{itemize}
\item a very simple approach, the Euclidean distance of phenotypic scores, 
\item a state-of-the-art approach, the phenotypic trajectory distance as defined in~\cite{Walter2010},
\item a divergence which enables the use of biological prior knowledge, the Sinkhorn divergence~\cite{sinkhorn}.
\end{itemize}

Let $i$ be a screening experiment, and $p$ the number of phenotypic classes ($p=15$ in our case). 
\subsubsection{Euclidean distance on phenotypic scores}
$i$ can be represented in $\mathbb{R}^p$ by $(ps_{k,i})_k$ the vector of its phenotypic scores. The distance between two experiments is then the Euclidean distance of their vectors of phenotypic scores, excluding \textit{Interphase} and \textit{Anaphase} scores. \textit{Interphase} score is excluded as its decrease is most of the time a summary of the increases of other scores. \textit{Anaphase} score is excluded because [WHATs the reason again?]. 

These vectors can be normalized with respect to the mean and standard deviation of phenotypic scores in the dataset. This will correspond to the \textbf{Normalized phenotypic score} distance in the following, whereas the non-normalized version will simply be called \textbf{Phenotypic score} distance.

These distances are robust to time delay in the onset of phenotypic changes. Indeed, as controls basically show a constant percentage of \textit{Interphase} nuclei, phenotypic scores will be identical for two experiments which show an increase in, e.g., \textit{Apoptosis} nuclei respectively at the beginning and at the end of the experiments. Hence the strength of these distances is that even if one experiment is identical with a delay to another, their distance will be small. It will however still be small if they're distinctly ordered, e.g. if one experiments shows the same phenotypic events than the other, albeit in the opposite order.

\subsubsection{Phenotypic trajectory distance}
On the other hand, it is possible to use the phenotypic trajectory distance as published in~\cite{Walter2010}. Briefly, let us re-use the notations of section~\ref{sec:ps}: $i$ is seen as $(\%_{k,i,t})_{k=1\ldots p,t=1\ldots T}$, that is, a sequence in $[0~;1]^p$. This sequence is then approximated by two p-dimensional vectors. The phenotypic trajectory distance between two experiments is then a distance between their vectors, as defined in formula 7 of~\cite{Walter2010}. This distance will be called \textbf{phenotypic trajectory} distance in the following.

This distance does not take explicitly time into account, but it respects the order of phenotypic changes. Hence its strength is that even if one experiment is identical with a delay to another, their distance will be small. It will not if they're distinctly ordered, as opposed to the phenotypic score distances.

\subsubsection{Sinkhorn divergence}
\paragraph{Motivations}
Finally, we wanted to test a distance which would enable us to use some prior biological knowledge of phenotypic class relationships. If we consider the two previous distances, they implicitly consider each phenotypic class to be independent of the others, and equally biologically far away from all. Indeed, the phenotypic score distances operate in $\mathbb{R}^p$ to sum the squared differences of phenotypic scores, hence treating the different phenotypes independently of eachother. Nevertheless, \textit{binucleated}, \textit{polylobed} and \textit{grape} nuclei are for example three different outcomes of cytokinesis defects. Hence the biological intuition is that a chemical causing a great increase in \textit{polylobed} nuclei has probably a closer mode of action to that of another one causing an increase in \textit{binucleated} nuclei than it is to that of a third one causing a strict increase in apoptosis.

Ideally, the idea is then that the distance of $a\%$ \textit{binucleated} nuclei to $b\%$ \textit{polylobed} nuclei is smaller than that to $b\%$ \textit{apoptosis} nuclei, or that it "costs" less to go from $a\%$ \textit{binucleated} nuclei to $b\%$ \textit{polylobed} nuclei than to $b\%$ \textit{apoptosis}. This is precisely the idea behind the Earth Mover's distance (or transportation distance, or Wasserstein distance). This distance was developed in the first place to compute the cost to move a certain number of piles of dirt into a certain numer of holes. To do so, one needs to take into account the distance between piles and holes.
\paragraph{Definitions}
Let us formalize this intuition and briefly introduce transportation distance\footnote{References and proofs can be found in~\cite{sinkhorn}.}. We note $\Sigma_d = \{ x \in \mathbb{R}^d_+ | x^T \mathbf{1}_d = 1\}$ the probability simplex. In our case, $d=13$: we can consider either the distributions of phenotypes in a given experiment over all time-points, or this distribution in a specific frame.

Given $r$ and $c$ in $\Sigma_d$, the transport polytope $U(r,c)$ is the set of matrices such that 
\[
U(r,c)=\{ P\in \mathbb{R}^{d\times d}_+ | P\mathbf{1}_d = r, P^T \mathbf{1}_d = c \}\] 
If $X$ and $Y$ are two discrete random variables with values in $ \{1,\ldots , d\} $ whose distributions are $r$ and $c$, the elements of $U(r,c)$ are in fact the possible joint probabilities of $\left( X,Y\right)$. Given a cost matrix $M$ in $\mathbb{R}^{d\times d}$, the optimal transportation distance between $r$ and $c$ is the solution of the following optimization program, where $<\cdot, \cdot> $ is the Frobenius matrix norm:
\begin{equation}
d_M(r,c) = \min_{\substack{P\in U(r,c)}} <M,P>
\label{exact_emd}
\end{equation}

Optimal solutions $P^*$ of~\ref{exact_emd} can be obtained. Furthermore, if $M$ is a metric matrix, this quantity is a distance~\cite{Villani}. This optimization program's complexity is in $O\left( d^3\log d\right) $ in theory and in practice, which makes it less applicable to high-dimensionality problems. 

In our case however, $d=13$, hence complexity is not a serious issue. An issue which is more relevant is that optimal solutions $P^*$ will lie on the vertices of $U(r,c)$. This is due to the linear quality of the optimization problem. It will produce almost deterministic joint probabilities~\cite{sinkhorn}. The idea is therefore to solve a regularized version of this program, placing ourselves in the following convex subset of $U(r,c)$, for $\alpha >0$:
\[
U_\alpha\left( r, c\right) = \{ P \in U\left( r,c \right) | \mathbf{KL}\left(P || rc^T\right)\leqslant \alpha\}
\]

The Sinkhorn divergence will be the following quantity, for $\alpha >0$:
\begin{equation}
d_{M, \alpha}(r,c) = \min_{\substack{P\in U_\alpha (r,c)}} <M,P>
\label{emd}
\end{equation}

This will produce less deterministic optimal solutions, which will converge to $P^*$ as $\alpha$ increases, while $d_{M, \alpha}(r,c)$ converges to $d_{M}(r,c)$. In practice, there exists an efficient method for solving the dual of this problem, Sinkhorn fixed-point algorithm~\cite{sinkhorn_original}. 

The solution for obtaining a faster computation of an approximate transportation distance is therefore to solve the dual problem of formula~\ref{emd}. Its solution will be used to compute the Sinkhorn divergence. For any $\alpha >0$, there exists $\lambda >0$ such that $d_{M, \alpha}(r,c) = d_{M, \lambda}(r,c)$, with
\[
d_{M, \lambda}(r,c) = <M,P^\lambda>,~~ P^\lambda = \argmin_{\substack{P\in U (r,c)}} <M,P> - \dfrac{1}{\lambda} h\left( P\right)
\]

The use of this divergence will enable us to take into account prior biological knowledge while computing distances between phenotypic distributions. This knowledge will be encoded in the cost matrix M. Its choice as well as $\lambda$'s is described infra. Practically, Sinkhorn fixed-point algorithm was implemented in Python to compute Sinkhorn divergences.

Finally, there are two ways to apply Sinkhorn divergence to the problem at hand with the parameters $M,~ \lambda$ as defined above. Let us consider two experiments $i$ and $j$ of duration $T$: 

\begin{itemize}
\item one can pool all nuclei from all frames by representing the experiments in $\Sigma_d$. This distance will be called \textbf{global Sinkhorn divergence} in the following (formula~\ref{global}),
\item one can choose to keep the temporal information by representing the experiments in $\left(\Sigma_d\right) ^T$. We will define two distances from this:
\subitem \textbf{max time Sinkhorn divergence}, which is the maximum of all timepoints Sinkhorn divergences (as detailed formula~\ref{max}),
\subitem \textbf{sum of time Sinkhorn divergence}, which is the sum of all timepoints Sinkhorn divergences (as detailed formula~\ref{int}).
\end{itemize}
\begin{equation}
D_{M,\lambda}(i,j)= d_{M,\lambda}((\%_{k,i})_{k},(\%_{k,j})_{k})
\label{global}
\end{equation}

\begin{equation}
D_{M,\lambda}^{max}(i,j)= \max_t d_{M,\lambda}((\%_{k,i,t})_{k},(\%_{k,j,t})_{k})
\label{max}
\end{equation}

\begin{equation}
D_{M,\lambda}^{sum}(i,j)= \sum_t d_{M,\lambda}((\%_{k,i,t})_{k},(\%_{k,j,t})_{k})
\label{int}
\end{equation}

\paragraph{Choice of phenotypic cost matrix}
The phenotypic cost matrix summarizes our biological knowledge about the phenotypes which were observed in the Mitocheck dataset (they include those which were observed in the drug screen). We made the choice to set inter-phenotypic costs according to the cellular process which is perturbed when they appear, or which they represent. The phenotypic cost matrix which we chose is illustrated fig.~\ref{cost}.

To resume our previous example, \textit{Polylobed}, \textit{Grape} and \textit{Binucleated} nuclei were considered to be closer to eachother than to any other phenotype, as they all result from cytokinesis defect. Nevertheless, \textit{Binucleated} nuclei were set slightly further apart from \textit{Polylobed} and \textit{Grape} nuclei than those two from eachother. This is because [EXPLANATION AGAIN ??].

Let us consider another example and take the group of \textit{Interphase}, \textit{Elongated} and \textit{Large} nuclei. They were set closer to eachother than to any other phenotype because they represent normal and abnormal versions of interphase nuclei.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.4]{figures/transportation_cost.png}
}
\caption{Cost matrix for phenotypic Sinkhorn divergence}
\label{cost}
\end{figure*}

\paragraph{Choice of $\lambda$} This choice will determine how close the Sinkhorn divergence is to the transportation distance. As expected, when $\lambda$ increases, the Sinkhorn divergence converges. This is illustrated fig.~\ref{lambda_choice1}. This figure also enables us to see that in the range of $\lambda$ which we investigated, there seems to be mainly two different behaviours: one which is shown at $\lambda=0.01$ and $\lambda=0.1$, and one which is shown at $\lambda=1$ and $\lambda=10$.

Our choice of $\lambda$ was driven by the ability to differenciate between Mitocheck hit experiments. As detailed in section~\ref{sec:selection_mitocheck}, these experiments are grouped according to the phenotype(s) of which they present a strikingly high percentage. We therefore visually compared the ability of $\lambda$'s two different value ranges to separate Mitocheck hit experiment from different phenotypic hit lists. 

This is shown on figures~\ref{lambda_choice_2} and~\ref{lambda_choice_3}: Mitocheck hit experiments are represented following the use of multi-dimensional scaling in 2 dimensions of their \textbf{global Sinkhorn divergences}. We clearly see that $\lambda=10$ seems to distinguish - to a certain extent - between distinct phenotypes, as opposed to $\lambda=0.1$. This is striking if we consider the example of \textbf{Binuclear} and \textbf{Cell death} hits (see also figures in Appendix, section~\ref{choice_param_Sinkhorn}). $\lambda=10$ was hence chosen.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.3]{figures/transportation_convergence_right_seg.png}
}
\caption{Convergence of Sinkhorn divergence as a function of lambda. Divergences were computed between drug screen experiments and Mitocheck hit experiments for different values of lambda, and the distribution of their relative variation to the divergences computed for $\lambda=30$ are showed here.}
\label{lambda_choice1}
\end{figure*}
\begin{figure*}[ht!]
\centerline{
\includegraphics[scale=0.25]{figures/MDS_lamb01.png}
}
\caption{Separation between Mitocheck hit categories (left) for $\lambda=0.1$. Global Sinkhorn divergences between Mitocheck hit experiments were computed for $\lambda=0.1$, and multi-dimensional scaling was used for representing them in two dimensions in the first two lines. Divergences between these experiments and the drug screen were included and their multi-dimension scaling is shown on the right plot.}
\label{lambda_choice_2}
\end{figure*}
\begin{figure*}[ht!]
\centerline{
\includegraphics[scale=0.25]{figures/MDS_lamb10.png}}
\caption{Separation between Mitocheck hit categories (left) for $\lambda=10$. Global Sinkhorn divergences between Mitocheck hit experiments were computed for $\lambda=10$, and multi-dimensional scaling was used for representing them in two dimensions in the first two lines. Divergences between these experiments and the drug screen were included and their multi-dimension scaling is shown on the right plot.}
\label{lambda_choice_3}
\end{figure*}

\subsubsection{Distance quality evaluation}
Six distances were selected to compare phenotypic profiles following drug/siRNA exposure. We then wanted to evaluate their ability to distinguish between different conditions without distinguishing between condition replicates. For this purpose, we computed for each distance $d$ and condition $C$ a separability score $S_d(C)$ as defined in formula~\ref{sepa} and a replicability score $R_d(C)$ as defined in formula~\ref{replica}. Separability compares the distance between replicates of the same condition to the distance to other conditions, whereas replicability measures the correlation between condition replicates to Mitocheck hit experiments.

Notations: for each experiment $i$ we note $C_i$ its condition, $d(i,M)$ the vector of distances between $i$ and all Mitocheck hit experiments and $corr$ the Pearson correlation.
\begin{equation}
S_d(C)=\dfrac{\sum_{\substack{i|C_i= C}} \sum_{\substack{k|C_k\neq C}} d(i,k)}{\sum_{\substack{i|C_i= C}} \sum_{\substack{j\neq i| C_j = C}} d(i,j)}
\label{sepa}
\end{equation}

\begin{equation}
R_d(C)=\dfrac{2}{(n-1)(n-2)}~ \sum_{\substack{i\\C_i= C}} \sum_{\substack{j\neq i\\ C_j = C}} corr(d(i,M), d(j,M))
\label{replica}
\end{equation}

The results are presented fig.~\ref{separability}. We can observe that all investigated distances score the same on average in terms of replicability and separability on drug screen hit conditions ; they are more different on all drug screen conditions. In the latter case, Sinkhorn divergences and the simple phenotypic score distance seem to better separate conditions than normalized phenotypic score and phenotypic trajectory distance, although not significantly. 

In both cases, there is a high standard deviation, as some conditions were visually observed to have lower reproducibility levels than the others. One can for example consider the reproducibility of the 10th dose of JNJ7706621 (see fig.~\ref{jnj} in appendix, section~\ref{sec:jnj}). This high standard deviation is therefore at least partly experimental, which means that none of the investigated distances is robust enough to cover it.

Based on these results, we chose to restrict ourselves to the phenotypic score distance, the phenotypic trajectory distance, the sum of time and global Sinkhorn divergences.


%For the separability score here it's distance to other conditions/distance to replicates if there is more than one replicate that passed QC. We look at hit conditions only because we feel that's where the real things are happening. It's easy to get a high reproducibility when nothing happens basically. Based on that we can restrict ourselves to phenotypic trajectory, euclidean distance on phenotypic score and either sum or max of time Sinkhorn distance.
\begin{figure*}[ht!]
\centerline{
\includegraphics[scale=0.3]{figures/separability_score_all_exp.png}
\includegraphics[scale=0.27]{figures/separability_score_hit_only.png}
}
\caption{Mean separability and replicability scores of investigated distances on all conditions (left) and hit conditions only (right - bars represent standard deviations).}
\label{separability}
\end{figure*}
%\begin{figure*}[ht!]
%\centerline{\includegraphics[scale=0.3]{figures/correlation_different_plates_hits_on_dist_to_Mitocheck_ttransport_max.png}
%}
%\caption{Replicate correlation of distances to Mitocheck hits}
%\label{replicate_correlation}
%\end{figure*}
%{'N_pheno_score': 0.59362688197421543,
% 'U_pheno_score': 0.48755546170997333,
% 'nature': 0.4740500150584811,
% 'transport': 0.3754272501191217,
% 'ttransport_INT': 0.41390462544644724,
% 'ttransport_MAX': 0.3963477934703899}

\subsection{Applications}
\label{sec:applications}
There are two main applications of phenotypic profiling to drug or small molecule screens~\cite{pmid17401369}. On the one hand, one might be interested in studying the similarity between the different conditions cells were exposed to. On the other hand, if there exists a parallel genetic screen, that is, a genetic screen which was performed in the same experimental conditions, one might be interested in comparing phenotypic profiles resulting from gene silencing or over-expression to phenotypic profiles resulting from drug exposure. These two applications could lead to the inference of possible targets for unknown chemicals, and might even give a hint as to a possible mode of action.

\subsubsection{Small molecule similarity evaluation}

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.55]{figures/Clust_0transport_ward_ward.png}}

\caption{Drug screen condition - Mitocheck siRNA two-dimensional hierarchical clustering using global Sinkhorn divergence. Ward method was used in combination with the Euclidean distance.}
\label{cond_clust_transport}
\end{figure*}

\paragraph{Condition clustering}
The median distance of each condition replicates to Mitocheck hit experiments was used to perform condition hierarchical clustering, for each investigated distance. The output for the global Sinkhorn divergence is illustrated fig.~\ref{cond_clust_transport}, and outputs for the other distances can be seen in appendix (see section~\ref{appendix:heatmaps}).

%Numbers and figures obtained by focusing on hits with 3 replicate hits
From 89\% to 100\% of (drug screen) hit conditions are clustering together, depending on the distance at hand. Furthermore, the clusters they belong to are composed of hit conditions at purity levels ranging from 85\% to 91\%. The dendrogram shows that these clusters present subclusters, which are at a certain distance from eachother (i.e. the dendrogram is not flat - see purple, white and blue clusters as indicated on the y-absciss colorbar on fig.~\ref{cond_clust_transport}). On the other hand, non-hit conditions are grouped in one large and flat cluster (see the red cluster on fig.~\ref{cond_clust_transport}). This means that non-hit conditions as described by their distance to Mitocheck hit experiments are not distinguishable, whereas hit conditions are.

We have chosen to summarize experiments by their nuclear phenotypic profiles, that is, the temporal sequence of nuclear phenotype distributions. Mitotic hits are conditions which alter cell mitosis. Hence they perturb the basal distribution of nuclei between normal nuclear phenotypes such as \textit{Interphase}, \textit{Metaphase}, etc., and strongly increase the basal percentage of abnormal nuclear phenotypes such as \textit{Polylobed}, \textit{Large}, etc. By construction, they are easily detected by our approach if they act within the experiment duration. 

It was not clear at the beginning that other type of hits could not be detected in our approach. From these clusterings, it nevertheless seems that chemicals which have an impact on different cellular processes, such as thalidomide whose known teratogenic effects might be linked to an inhibition of ubiquitin ligase~\cite{pmid20223979}, cannot be detected. It could also be that they do not have any effect on HeLa cells, or that they would need more exposure time for an effect to be detected.

%The precise mechanism of action for thalidomide is unknown, but possible mechanisms include anti-angiogenic and oxidative stress-inducing effects.[22]

The conclusion of these clusterings is that our information representation is suitable for detecting and infering knowledge regarding mitotic hit conditions, whereas it is not for non-mitotic hit conditions. In the following, we therefore restrict ourselves to the hit conditions which we have detected as described in section~\ref{sec:selection_ds}, i.e. mitotic hit conditions.
%POINT 1 In theory we could learn from the screen even if the drug is not directly targeted at something directly involved in mitosis but here we see that no


\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.6]{figures/Clust_1transport_ward_ward.png}}
\caption{Drug screen \textbf{hit} condition - Mitocheck siRNA two-dimensional hierarchical clustering using global Sinkhorn divergence. Ward method was used in combination with the Euclidean distance.}
\label{hitcond_clust_transport}
\end{figure*}

\begin{table}[!ht]
\centering
\caption{Known protein targets of hit drugs (bold: present in Mitocheck hit experiments). Drugs are grouped by target similarity. Source: DrugBank~\cite{pmid18048412} unless specified.}
\label{drug_target}
\begin{tabular}{|L{3cm}|L{7cm}|L{4cm}|}
\hline
Drug & Protein target (HUGO gene symbol) & Other targets\\
\hline
Anisomycin &RPL10L,	RPL13A,	RPL23,	RPL15,	\textbf{RPL19},	RPL23A,	RSL24D1,	RPL26L1,	RPL8,	RPL37,	RPL3,	RPL11, \textbf{NHP2L1} &\\	
\hline							
Azacytidine 5 & DNMT1 & DNA and RNA hypomethylation	\\								
\hline
Camptothecin (S,+)& TOP1&\\								
\hline
Daunorubicin hydrochloride & TOP2A, TOP2B & ds-DNA intercalating agent\\ %interc	inhib	inhib			
Doxorubicin	hydrochloride &	TOP2A & ds-DNA intercalating agent\\%interc	inhib					
Etoposide & TOP2A, TOP2B&\\		%	inhib	inhib		
\hline											
JNJ7706621	& \textbf{AURKA}, \textbf{AURKB}, \textbf{CDK1}, CDK2, CDK3, \textbf{CDK4}, CDK6\cite{pmid16204078} &\\	
MLN8054	& \textbf{AURKA}\cite{pmid20197380} & \\
R763 & \textbf{AURKA}, \textbf{AURKB}, FLT3, VEGFR2~\cite{pmid19609559}&\\
VX680 &	\textbf{AURKA}, \textbf{AURKB}&\\
\hline	
Nocodazole & \textbf{HPGDS}, TUBB (\textbf{B2A, B4A,B4B,B6}) &Microtubule destabilizer\\			
Paclitaxel & \textbf{BCL2},TUBB1, NR1I2, MAPT, MAP4, MAP2 &Microtubule stabilizer\\
\hline
\end{tabular}
\end{table}

\paragraph{Hit condition clustering}
Hit condition clustering was realized in the same way. The output for the global Sinkhorn divergence can be seen fig.~\ref{hitcond_clust_transport} ; other distance outputs are displayed in appendix section~\ref{appendix:hit_heatmaps}.

Existing knowledge about hit condition targets, as displayed in table~\ref{drug_target}, can be used to evaluate the consistency of clustering results\footnote{Unfortunately, our dose ranges are too different from that of~\cite{pmid15539606} to compare our clustering results to those of~\cite{pmid17401369}.}. Ideally, drugs with similar targets on the one hand, and similar doses from the same drug on the other hand, cluster together. A way to visualize how the different distances perform with regard to that, is to look at the binary maps which are presented on fig.~\ref{binary_map_ps}, \ref{binary_map_transport} and in appendix section~\ref{appendix:hit_heatmaps}. On these binary maps, drugs have been grouped by target similarity as in table~\ref{drug_target}.

The binary map from phenotypic score distance (fig.~\ref{binary_map_ps}) shows little agreement with the literature: conditions seem to randomly belong to the same cluster. On the other hand, the binary map from global Sinkhorn divergence produces a structure which is more in agreement with the current knowledge (fig.~\ref{binary_map_transport}). For example, doses 5 to 10 of Paclitaxel are clustered together with doses 8 to 10 of Nocodazole, which is consistent with their being both targeted at $\beta$-tubulin. Another interesting example is that of Anisomycin. Its doses 5 to 8 constitute a single cluster according to global Sinkhorn divergence. This is consistent with Anisomycin being the only drug in the drug screen to inhibit protein synthesis. The same thing can be observed for doses 3 to 10 of Camptothecin (S,+): they cluster together in an almost pure cluster, which is consistent with Camptothecin (S,+) being the only drug inhibiting topoisomerase I. 

Furthermore, the hierarchy of these clusters is also understandable in the light of the existing literature. Indeed, the highest doses of drugs which are targeted at Aurora kinases (JNJ7706621, MLN8054 and VX680 which are in the dark blue cluster on fig.~\ref{hitcond_clust_transport}) is the closest cluster to the one which contains high Paclitaxel and Nocodazole doses (pink cluster). The latter drugs are targeted at tubulin, when Aurora kinases are linked to microtubules as well (NCBI Gene webpages\cite{pmid24259432}). Hence the cluster hierarchy is consistent, with closer clusters pointing at common biological process target.

The binary map from time Sinkhorn divergence (fig.~\ref{binary_map_ttransport_INT}) shows little difference with that from global Sinkhorn divergence. Finally, the binary map from phenotypic trajectory distance (fig.~\ref{binary_map_nature}) shows more agreement with the literature than the phenotypic score distance's (e.g. a high number of conditions of Etoposide, Doxorubicin hydrochloride and Daunorubicin hydrochloride cluster together), but seems less refined than any of the Sinkhorn's maps (e.g. most doses of Camptothecin (S,+) are included in the aforementioned cluster). % On the other hand, its doses 3 and 4 cluster with the previously mentioned Nocodazole-Paclitaxel cluster, which can be explained by the increased presence of \textit{Polylobed}, \textit{Prometaphase} and \textit{Apoptosis} nuclei. %which can be explained by the fact that these conditions result in nothing else than apoptosis. %Doses 3 and 4 of 

Another observation can be made from these clustering results. All three "sophisticated" distances, the phenotypic trajectory distance, the global and time Sinkhorn divergences, present a cluster which can be named a small dose cluster (respectively green, yellow and red as indicated by the y-absciss colorbar on figures~\ref{hitcond_clust_nature}, \ref{hitcond_clust_transport} and \ref{hitcond_clust_ttransport_INT}). It contains mostly the smallest doses for each drug hit: Anisomycin dose 1, Daunorubicin hydrochloride dose 0, Azacytidin 5 doses 8 and 9, etc. Interestingly, these conditions have in common very unspecific phenotypic consequences: slight increases in \textit{Elongated} and/or \textit{Large} and/or \textit{Polylobed} and/or \textit{Binucleated} nuclei, without any increase in \textit{Apoptosis} nuclei. This can be seen in the phenotypic plots which are in the supplementaries, folder "Phenotypic score plots\_type2".

Global and time Sinkhorn divergence results present a second unspecific effect cluster (respectively green and yellow-green on figures~\ref{hitcond_clust_transport} and \ref{hitcond_clust_ttransport_INT}), which contains mostly small to medium doses for each drug hit: Daunorubicin hydrochloride doses 2, 3, 4, Azacytidin 5 dose 10, etc. Similarly to the small dose cluster, these conditions have very unspecific effects in common. Contrary to the small dose clusters, they present a non-negligeable level of \textit{Apoptosis} nuclei. This cluster is not present in the phenotypic trajectory distance results.

\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.25]{figures/cond_clustering_U_pheno_score.png}}
\caption{Visualization of condition clustering for phenotypic score distance. A black dot means that the conditions belong to the same cluster, a white dot that they do not.}
\label{binary_map_ps}
\end{figure*}
\begin{figure*}[ht!]
\centerline{%\includegraphics[scale=0.25]{figures/cond_clustering_U_pheno_score.png}
\includegraphics[scale=0.25]{figures/cond_clustering_transport.png} }
\caption{Visualization of condition clustering for global Sinkhorn divergence. A black dot means that the conditions belong to the same cluster, a white dot that they do not.}
\label{binary_map_transport}
\end{figure*}

From these observations we can conclude that both Sinkhorn divergences (and especially global Sinkhorn divergence) produce drug similarities which better correspond to the existing knowledge. Furthermore, these similarities are easily understandable by going back to the phenotypic scores and the cost matrix, as opposed to the phenotypic trajectory distance. As an example, Anisomycin doses 5-8 cluster is very likely a result of the exclusive high increase in \textit{Apoptosis} nuclei which is observed in these experiments, and of \textit{Apoptosis} being at a cost of 5 from all other phenotypes. Finally, these results also show that for almost all drugs, small doses produce unspecific effects which seem difficult to be robustly linked to any gene silencing experiment. Our focus for target pathway inference will therefore be condition clusters which are not small/medium dose clusters, using global Sinkhorn divergence.

%POINT 2 so we focus on hits detected on phenotypic scores. Here is what we have in terms of hit reproducibility: means it's high. Good sign/ better say in terms of more than 50\% experiments that passed QC
%Counter({3: 55, 2: 14, 1: 4})
%Not working well for phenotypic score with other clustering methods as well (not shown, 'single' and 'centroid'). Working better for phenotypic trajectory distance: centroid
\subsubsection{Target pathway inference [TODO]}
SO
- cluster 1. Almost only anisomycin so looking for links to topoisomerase I = DNA binding. Good thing, we get pval $10^-3$ cyclic nucleotide binding from INTERPRO
- cluster 4 : nothing. Ribosomal prot?
- cluster 5 : very good 
%Category	Term	Count	%	PValue	Genes	List Total	Pop Hits	Pop Total	Fold Enrichment	Bonferroni	Benjamini	FDR
%GOTERM_CC_FAT	GO:0030496~midbody	3	3.0927835051546393	0.006747806003324053	ENSG00000149503, ENSG00000137807, ENSG00000178999	60	4	1706	21.325000000000003	0.5824776171102156	0.5824776171102156	7.571923225882838
%GOTERM_CC_FAT	GO:0015630~microtubule cytoskeleton	9	9.278350515463918	0.01929609820677492	ENSG00000168397, ENSG00000136861, ENSG00000138778, ENSG00000134779, ENSG00000149503, ENSG00000158296, ENSG00000137807, ENSG00000178999, ENSG00000087586	60	100	1706	2.5589999999999997	0.919017811499282	0.7154263039198493	20.275782328585567
%GOTERM_BP_FAT	GO:0032355~response to estradiol stimulus	3	3.0927835051546393	0.019998492992519698	ENSG00000163794, ENSG00000073756, ENSG00000087586	71	6	1810	12.746478873239436	0.9999998347000388	0.9999998347000388	26.559147263763283
%GOTERM_CC_FAT	GO:0044430~cytoskeletal part	11	11.34020618556701	0.020893562835221674	ENSG00000168397, ENSG00000164877, ENSG00000196535, ENSG00000136861, ENSG00000138778, ENSG00000134779, ENSG00000149503, ENSG00000158296, ENSG00000137807, ENSG00000178999, ENSG00000087586	60	142	1706	2.202582159624413	0.9343767317556939	0.5966463865431619	21.7730081784446
%KEGG_PATHWAY	hsa03040:Spliceosome	5	5.154639175257731	0.0235552467649326	ENSG00000132792, ENSG00000143977, ENSG00000183684, ENSG00000108883, ENSG00000171566	26	34	741	4.1911764705882355	0.6815153868683974	0.6815153868683974	20.34706278145585
%UP_SEQ_FEATURE	compositionally biased region:Pro-rich	10	10.309278350515463	0.024233857317716975	ENSG00000168874, ENSG00000169379, ENSG00000104946, ENSG00000120685, ENSG00000110237, ENSG00000213079, ENSG00000189132, ENSG00000139266, ENSG00000218891, ENSG00000105321	88	116	2369	2.320728840125392	0.9989857283411681	0.9989857283411681	27.715004462895575
%SP_PIR_KEYWORDS	cytoskeleton	9	9.278350515463918	0.026537825101213105	ENSG00000164877, ENSG00000196535, ENSG00000136861, ENSG00000138778, ENSG00000134779, ENSG00000149503, ENSG00000137807, ENSG00000178999, ENSG00000087586	88	99	2371	2.4493801652892566	0.9953887759443192	0.9953887759443192	28.61749692602379
%GOTERM_BP_FAT	GO:0000087~M phase of mitotic cell cycle	6	6.185567010309279	0.038089104316049394	ENSG00000138778, ENSG00000149503, ENSG00000137807, ENSG00000178999, ENSG00000090061, ENSG00000087586	71	49	1810	3.1215866628341478	0.9999999999999081	0.9999996968781568	44.755748335117865
%GOTERM_BP_FAT	GO:0007067~mitosis	6	6.185567010309279	0.038089104316049394	ENSG00000138778, ENSG00000149503, ENSG00000137807, ENSG00000178999, ENSG00000090061, ENSG00000087586	71	49	1810	3.1215866628341478	0.9999999999999081	0.9999996968781568	44.755748335117865
%GOTERM_BP_FAT	GO:0000280~nuclear division	6	6.185567010309279	0.038089104316049394	ENSG00000138778, ENSG00000149503, ENSG00000137807, ENSG00000178999, ENSG00000090061, ENSG00000087586	71	49	1810	3.1215866628341478	0.9999999999999081	0.9999996968781568	44.755748335117865
%GOTERM_BP_FAT	GO:0048285~organelle fission	6	6.185567010309279	0.04108382856607934	ENSG00000138778, ENSG00000149503, ENSG00000137807, ENSG00000178999, ENSG00000090061, ENSG00000087586	71	50	1810	3.0591549295774647	0.9999999999999918	0.9999797940650837	47.326299602180896

- cluster 6 : also very good
%Category	Term	Count	%	PValue	Genes	List Total	Pop Hits	Pop Total	Fold Enrichment	Bonferroni	Benjamini	FDR
%GOTERM_BP_FAT	GO:0031023~microtubule organizing center organization	4	4.166666666666666	0.004429641780725094	ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000174799	66	10	1810	10.96969696969697	0.9689350374024023	0.9689350374024023	6.568575360037476
%GOTERM_BP_FAT	GO:0051297~centrosome organization	4	4.166666666666666	0.004429641780725094	ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000174799	66	10	1810	10.96969696969697	0.9689350374024023	0.9689350374024023	6.568575360037476
%GOTERM_BP_FAT	GO:0007017~microtubule-based process	8	8.333333333333332	0.005213316096123827	ENSG00000088727, ENSG00000165731, ENSG00000138778, ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000174799, ENSG00000087586	66	61	1810	3.5966219572776947	0.9832184821175997	0.8704565019678705	7.687812664329852
%GOTERM_CC_FAT	GO:0015630~microtubule cytoskeleton	10	10.416666666666668	0.007665104072211499	ENSG00000088727, ENSG00000168397, ENSG00000136861, ENSG00000138778, ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000158296, ENSG00000174799, ENSG00000087586	62	100	1706	2.7516129032258063	0.6322316989971262	0.6322316989971262	8.571025121655328
%GOTERM_BP_FAT	GO:0000226~microtubule cytoskeleton organization	6	6.25	0.00813995448007545	ENSG00000165731, ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000174799, ENSG00000087586	66	36	1810	4.570707070707071	0.9983242476832465	0.8812218355733932	11.757791257737393
%GOTERM_CC_FAT	GO:0044430~cytoskeletal part	12	12.5	0.00989087934640652	ENSG00000088727, ENSG00000168397, ENSG00000164877, ENSG00000196535, ENSG00000136861, ENSG00000138778, ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000158296, ENSG00000174799, ENSG00000087586	62	142	1706	2.3253066787823715	0.7253383976270503	0.47591832471173956	10.930884525227357
%GOTERM_CC_FAT	GO:0005813~centrosome	6	6.25	0.016747420691283058	ENSG00000136861, ENSG00000181163, ENSG00000175216, ENSG00000158296, ENSG00000174799, ENSG00000087586	62	43	1706	3.839459864966241	0.8887084311697437	0.5189900189364942	17.85494162864303
%GOTERM_BP_FAT	GO:0032355~response to estradiol stimulus	3	3.125	0.017353862099464806	ENSG00000163794, ENSG00000073756, ENSG00000087586	66	6	1810	13.712121212121213	0.9999988661057935	0.9673680419436156	23.502903552680266
%GOTERM_BP_FAT	GO:0007098~centrosome cycle	3	3.125	0.017353862099464806	ENSG00000181163, ENSG00000138160, ENSG00000174799	66	6	1810	13.712121212121213	0.9999988661057935	0.9673680419436156	23.502903552680266
%SP_PIR_KEYWORDS	ubl conjugation	8	8.333333333333332	0.01866853185470882	ENSG00000170775, ENSG00000138778, ENSG00000179262, ENSG00000181163, ENSG00000136931, ENSG00000175467, ENSG00000167513, ENSG00000087586	86	77	2371	2.8643914225309572	0.9669899399228736	0.9669899399228736	20.732151201231876
%GOTERM_CC_FAT	GO:0005815~microtubule organizing center	6	6.25	0.023923658661183473	ENSG00000136861, ENSG00000181163, ENSG00000175216, ENSG00000158296, ENSG00000174799, ENSG00000087586	62	47	1706	3.512697323266987	0.9570570168147403	0.5447781989170656	24.571832556495345
%SP_PIR_KEYWORDS	phosphoprotein	46	47.91666666666667	0.02814144953470771	ENSG00000164877, ENSG00000154040, ENSG00000164081, ENSG00000165731, ENSG00000126895, ENSG00000178764, ENSG00000138778, ENSG00000179262, ENSG00000073756, ENSG00000107779, ENSG00000175467, ENSG00000183684, ENSG00000138092, ENSG00000186517, ENSG00000167513, ENSG00000181163, ENSG00000152457, ENSG00000136931, ENSG00000138160, ENSG00000142875, ENSG00000188493, ENSG00000070756, ENSG00000174799, ENSG00000099864, ENSG00000105321, ENSG00000088727, ENSG00000168397, ENSG00000184611, ENSG00000143393, ENSG00000054148, ENSG00000090061, ENSG00000158023, ENSG00000163191, ENSG00000136861, ENSG00000157637, ENSG00000134255, ENSG00000196535, ENSG00000120685, ENSG00000130725, ENSG00000198646, ENSG00000175216, ENSG00000172922, ENSG00000164076, ENSG00000108883, ENSG00000143337, ENSG00000087586	86	1002	2371	1.2656779464327157	0.9942963370495567	0.9244774010613818	29.66692103142814
%SMART	SM00129:KISc	3	3.125	0.041875793864220794	ENSG00000088727, ENSG00000138778, ENSG00000138160	39	10	1129	8.684615384615384	0.8193356369004172	0.8193356369004172	32.38741402598828
%INTERPRO	IPR019821:Kinesin, motor region, conserved site	3	3.125	0.042330902096120344	ENSG00000088727, ENSG00000138778, ENSG00000138160	73	10	2136	8.778082191780822	0.9992705691490504	0.9992705691490504	40.90905867726769
%INTERPRO	IPR001752:Kinesin, motor region	3	3.125	0.042330902096120344	ENSG00000088727, ENSG00000138778, ENSG00000138160	73	10	2136	8.778082191780822	0.9992705691490504	0.9992705691490504	40.90905867726769
%SP_PIR_KEYWORDS	Spliceosome	5	5.208333333333334	0.04493156055370322	ENSG00000183684, ENSG00000175467, ENSG00000070756, ENSG00000108883, ENSG00000171566	86	38	2371	3.627600979192166	0.9997566432508358	0.9375669624558921	43.2654392449582
%UP_SEQ_FEATURE	short sequence motif:Selectivity filter	3	3.125	0.04748645729787534	ENSG00000184611, ENSG00000089558, ENSG00000157542	86	10	2369	8.263953488372092	0.9999980266098107	0.9999980266098107	47.25334874271313
%UP_SEQ_FEATURE	domain:Kinesin-motor	3	3.125	0.04748645729787534	ENSG00000088727, ENSG00000138778, ENSG00000138160	86	10	2369	8.263953488372092	0.9999980266098107	0.9999980266098107	47.25334874271313
%GOTERM_CC_FAT	GO:0005681~spliceosome	5	5.208333333333334	0.04777066360520638	ENSG00000183684, ENSG00000175467, ENSG00000070756, ENSG00000108883, ENSG00000171566	62	39	1706	3.5277088502894953	0.99827653515842	0.7199210396532453	43.449681659215344
%GOTERM_CC_FAT	GO:0005856~cytoskeleton	13	13.541666666666666	0.0489480610232903	ENSG00000164877, ENSG00000168397, ENSG00000088727, ENSG00000154040, ENSG00000138778, ENSG00000196535, ENSG00000136861, ENSG00000181163, ENSG00000138160, ENSG00000175216, ENSG00000158296, ENSG00000174799, ENSG00000087586	62	202	1706	1.770839987224529	0.9985325929765634	0.6629002486071968	44.25862476648472
\begin{figure*}[ht!]
\centerline{\includegraphics[scale=0.4]{figures/inference_evaluation_gene_rank.png}
}
\caption{Index of known drug targets in function of their closeness to drug screen experiments as measured by the different distances}
\label{gene_rank}
\end{figure*}
%Rang moyen des cibles connues en fonction des differentes distances:

%Taking conditions with 2 or 3 replicate hits
%(['Normalized\n phenotypic score',
%  'Phenotypic score',
%  'Global\n Sinkhorn div.',
%  'Phenotypic\n trajectory',
%  'Sum of time\n Sinkhorn div.',
%  'Max time \n Sinkhorn div.'],
%MEAN array([ 919.59701493,  697.86567164,  748.67164179,  728.32835821,
%         730.94029851,  790.94029851]),
%STD array([ 771.89969304,  697.96328209,  722.39546345,  722.65462918,
%         818.89530395,  833.70951097]))

%Conditions with 3 replicate hits
%(['Normalized\n phenotypic score',
%  'Phenotypic score',
%  'Global\n Sinkhorn div.',
%  'Phenotypic\n trajectory',
%  'Sum of time\n Sinkhorn div.',
%  'Max time \n Sinkhorn div.'],
% array([ 858.42105263,  650.49122807,  641.43859649,  645.56140351,
%         643.21052632,  732.49122807]),
% array([ 735.60186475,  666.84186618,  629.07743694,  655.08301382,
%         744.61728629,  800.71350031]))

%=> Pour la suite je me limite a 
%  'Phenotypic score',
%  'Global\n Sinkhorn div.',
%  'Phenotypic\n trajectory',
%  'Sum of time\n Sinkhorn div.',

\subsection{Discussion [TODO]}
Regarding the time transport distance, another idea could be to do dynamic time warping on frame correspondence rather than just 1-to-1. Indeed, the effect of the siRNA which we observe, is function of protein half-life, [prot] necessary for the cell to get its function rightly performed, as well as  if the prot has a direct or indirect function to play in cell division (or cell motility or whatever the process is that we consider).

Furthermore, the phenotypic onset of the siRNA can be rather different than that of the drug because the drug directly acts on its target rather than get the mRNAs of this target destructed.

Something else for the discussion: can have more than one target, and also not to forget are off-target effects

Also: penetrance of phenotypes always higher in the drug screen than in siRNA experiments

\cite{pmid18066055} work directly on feature distributions from the experiments (we work on nuclear phenotypes which are already an information summary of each image). Idea, we should check what we get by staying at the feature level on each image.
